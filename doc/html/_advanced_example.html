<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>libfbi: A more advanced example</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">libfbi
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">A more advanced example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This toy example illustrates the use of two sets in the fast box intersection procedure, where the underlying sets have different types. The sample use case mimicks the task of a soccer scout, searching soccer players that fit a position, age and salary description that clubs are interested in and, vice versa, also determines the set of clubs each player could play in, given his player profile.</p>
<p>First we set up the includes <div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a01071.html">string</a>&gt;</span>
<span class="preprocessor">#include &lt;<a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a01112.html">vector</a>&gt;</span>
<span class="preprocessor">#include &quot;fbi/tuple.h&quot;</span>
<span class="preprocessor">#include &quot;fbi/tuplegenerator.h&quot;</span> <span class="comment">//TraitsGenerator</span>
<span class="preprocessor">#include &quot;fbi/fbi.h&quot;</span> <span class="comment">//SetA::intersect</span>
</pre></div></p>
<p>A soccer player is represented by the following struct <div class="fragment"><pre class="fragment"><span class="keyword">struct </span>Player {
    <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a01203.html#ga32db3d9898c44d3b3a578b560f7758cc">std::string</a> name;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> position;
    <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00269.html">std::pair&lt;double, double&gt;</a> price;
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> age;
};
</pre></div> whereas clubs are modeled using <div class="fragment"><pre class="fragment"><span class="keyword">struct </span>Club {
    <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a01203.html#ga32db3d9898c44d3b3a578b560f7758cc">std::string</a> name;
    <span class="keywordtype">double</span> minBudget;
    <span class="keywordtype">double</span> maxBudget;
};
</pre></div></p>
<p>Now we need to define the respective box operators, that return intervals in each dimension. As a precondition, we need to define the traits for each of the classes:</p>
<p><div class="fragment"><pre class="fragment"><span class="keyword">namespace </span>fbi {
  
<span class="keyword">template</span>&lt;&gt;
<span class="keyword">struct </span>Traits&lt;Player&gt; : mpl::TraitsGenerator&lt;double, double, unsigned int, std::string&gt; {};

<span class="keyword">template</span>&lt;&gt;
<span class="keyword">struct </span>Traits&lt;Club&gt; : mpl::TraitsGenerator&lt;double, unsigned int, std::string, double&gt; {};

} <span class="comment">// end namespace</span>
</pre></div></p>
<p>The box generator class definition for the <code>Player</code> class is</p>
<p><div class="fragment"><pre class="fragment"><span class="keyword">struct </span>PlayerBoxGenerator
{
  <span class="keyword">template</span> &lt;std::<span class="keywordtype">size_t</span> N&gt;
  <span class="keyword">typename</span> fbi::tuple_element&lt;N, 
    <span class="keyword">typename</span> fbi::Traits&lt;Player&gt;::key_type&gt;::type 
  <span class="keyword">get</span>(<span class="keyword">const</span> Player&amp;) <span class="keyword">const</span>;
};
</pre></div></p>
<p>and we need to specialize the template member function for each dimension. For the player, we choose a dimension order of <code>position</code>, <code>price</code>, and <code>age</code>. This yields</p>
<p><div class="fragment"><pre class="fragment"><span class="keyword">template</span> &lt;&gt;
<a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00269.html">std::pair&lt;double, double&gt;</a>  
PlayerBoxGenerator::get&lt;0&gt;(<span class="keyword">const</span> Player&amp; p) <span class="keyword">const</span> 
{
  <span class="keywordflow">return</span> <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a01138.html#a9345a6e2e39831b4291cac2e52a15792">std::make_pair</a>(
    static_cast&lt;double&gt;(p.position), 
    static_cast&lt;double&gt;(p.position));
}
</pre></div></p>
<p>for the position,</p>
<p><div class="fragment"><pre class="fragment"><span class="keyword">template</span> &lt;&gt;
<a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00269.html">std::pair&lt;double, double&gt;</a>  
PlayerBoxGenerator::get&lt;1&gt;(<span class="keyword">const</span> Player&amp; p) <span class="keyword">const</span> 
{
  <span class="keywordflow">return</span> p.price;
}
</pre></div></p>
<p>for the price, and</p>
<p><div class="fragment"><pre class="fragment"><span class="keyword">template</span> &lt;&gt;
<a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00269.html">std::pair&lt;unsigned int, unsigned int&gt;</a>  
PlayerBoxGenerator::get&lt;2&gt;(<span class="keyword">const</span> Player&amp; p) <span class="keyword">const</span> 
{
  <span class="keywordflow">return</span> <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a01138.html#a9345a6e2e39831b4291cac2e52a15792">std::make_pair</a>(p.age, p.age);
}
</pre></div></p>
<p>for the age dimension.</p>
<p>We repeat the procedure for the <code>Club</code> class, however, for illustration purposes, we flip the order of the dimension (and unflip it in the call to <code>intersect</code> later). The definition of the box operator is</p>
<p><div class="fragment"><pre class="fragment"><span class="keyword">class </span>ClubBoxGenerator
{
  <span class="keyword">public</span>:
  ClubBoxGenerator(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> position,
    <span class="keyword">const</span> <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00269.html">std::pair&lt;unsigned int, unsigned int&gt;</a>&amp; age)
  : position_(position), age_(age)
  { 
    age_.second++;
  }

  <span class="keyword">template</span> &lt;std::<span class="keywordtype">size_t</span> N&gt;
  <span class="keyword">typename</span> fbi::tuple_element&lt;N,
    <span class="keyword">typename</span> fbi::Traits&lt;Club&gt;::key_type&gt;::type
  <span class="keyword">get</span>(<span class="keyword">const</span> Club&amp;) <span class="keyword">const</span>;

  <span class="keyword">private</span>:
    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> position_;
    <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00269.html">std::pair&lt;unsigned int, unsigned int&gt;</a> age_;
};
</pre></div></p>
<p>and the necessary template specifications are</p>
<p><div class="fragment"><pre class="fragment"><span class="keyword">template</span> &lt;&gt;
<a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00269.html">std::pair&lt;double, double&gt;</a>
ClubBoxGenerator::get&lt;0&gt;(<span class="keyword">const</span> Club&amp; c) <span class="keyword">const</span>
{
    <span class="keywordflow">return</span> <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a01138.html#a9345a6e2e39831b4291cac2e52a15792">std::make_pair</a>(
      static_cast&lt;double&gt;(position_) - 0.1,
      static_cast&lt;double&gt;(position_) + 0.1);
}
</pre></div></p>
<p>for the position,</p>
<p><div class="fragment"><pre class="fragment"><span class="keyword">template</span> &lt;&gt;
<a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00269.html">std::pair&lt;unsigned int, unsigned int&gt;</a>  
ClubBoxGenerator::get&lt;1&gt;(<span class="keyword">const</span> Club&amp; c) <span class="keyword">const</span> 
{
  <span class="keywordflow">return</span> age_;
}
</pre></div></p>
<p>for the age, and</p>
<p><div class="fragment"><pre class="fragment"><span class="keyword">template</span> &lt;&gt;
<a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00269.html">std::pair&lt;std::string, std::string&gt;</a>
ClubBoxGenerator::get&lt;2&gt;(<span class="keyword">const</span> Club&amp; c) <span class="keyword">const</span>
{
    <span class="keywordflow">return</span> <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a01138.html#a9345a6e2e39831b4291cac2e52a15792">std::make_pair</a>(c.name, c.name);
}
</pre></div></p>
<p>for the price dimension (note the different dimension order!).</p>
<p>To illustrate our type definitions, we write a short <code>main</code> program</p>
<p><div class="fragment"><pre class="fragment"><span class="keywordtype">int</span> main() {
  <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00730.html">std::vector&lt;Player&gt;</a> players;
  <a class="codeRef" doxygen="libstdc++.tag:http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/" href="http://gcc.gnu.org/onlinedocs/libstdc++/latest-doxygen/a00730.html">std::vector&lt;Club&gt;</a> clubs;
</pre></div></p>
<p>We now make use of one convenient property of the libfbi API, which allows us to pass multiple box operators into the intersection procedure. We instanciate <code>Club</code> boxes for every position for which players are sought.</p>
<p><div class="fragment"><pre class="fragment"></pre></div></p>
<p>Finding suitable players for all clubs and suitable clubs for all players now is a simple matter of calling the nested <code>intersect</code> function. Note the flipped dimension indexes in the inner <code>SetB</code> template specification.</p>
<p><div class="fragment"><pre class="fragment"></pre></div></p>
<p>That's it!</p>
<p><div class="fragment"><pre class="fragment"></pre></div> </p>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Apr 20 2012 13:41:33 for libfbi by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
